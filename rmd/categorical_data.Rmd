---
title: "Categorical EDA"
author: "Mengxiao Luan, Yuzhe Hu"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: "hide"
---

**Carrying out some descriptive and exploratory analysis based on cleaned data sets.**

We conduct some exploratory analysis from three main aspects:

* regarding general distribution: 

  * net worth of wealth(billions of dollars)
  * approach of becoming a billionaire(self-made or not)
  * wealth status(increasing, decreasing, stable or returning)
  
* regarding demographic information:

  * age
  * gender
  * country(country of citizenship, country of residence)
  
* regarding economic development:
  
  * industry
  * industry GDP

```{r lib-import, message = FALSE}
library(tidyverse)
library(readxl)
library(janitor)
library(forcats)
library(plotly)
library(ggpubr)
```

```{r setup}
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	message = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d

theme_set(theme_minimal() + theme(legend.position = "right"))
```

```{r data}
# import data
bil_2010_2023 =
  read_csv("../data/billionaire_gdp.csv") |>
  select(-starts_with("region")) |>
  drop_na()

bil_gdp = read_csv("../data/billionaire_gdp_indus_usa.csv") |>
  select(-(age:wealth_status)) |>
  drop_na()
```

## Focus on data collected in 2023

Have a quick look at the data.

```{r summary}
# filter data
bil_2023 = 
  bil_2010_2023 |>
  filter(year == 2023)

# describe data
bil_2023 |>
  skimr::skim()
```

### General Distributions

#### Distribution of Wealth

First depict the overall wealth distribution of the billionaires.

```{r wealth}
# overall distribution
wealth_distribution_1 =
  bil_2023 |>
  ggplot(aes(x = net_worth)) +
  geom_histogram() +
  labs(x = "net wealth(billion dollars)")

wealth_distribution_2 =
  bil_2023 |>
  ggplot(aes(x = net_worth)) +
  geom_density() +
  labs(x = "net wealth(billion dollars)")

ggarrange(wealth_distribution_1, wealth_distribution_2,
          labels = c("A", "B"), ncol = 1, nrow = 2) |>
  annotate_figure(
    top = text_grob("Overall Wealth Distribution of Billionaires in 2023",
                    face = "bold", size = 15))
```

It can be seen from the plots that the wealth distribution in 2023 is right-skewed, with outliers lying on the right side of the axis. 

Further transformation may be required for detailed tests and regression model fitting. Try a relatively simple transformation to better visualize the distribution shown above.

```{r transformation}
MASS::boxcox(lm(net_worth ~ 1, data = bil_2023))

wealth_distribution_3 =
  bil_2023 |>
  ggplot(aes(x = net_worth^(-0.5))) +
  geom_histogram() +
  labs(x = "net wealth(transformed)")

wealth_distribution_4 =
  bil_2023 |>
  ggplot(aes(x = net_worth^(-0.5))) +
  geom_density() +
  labs(x = "net wealth(transformed)")

ggarrange(wealth_distribution_3, wealth_distribution_4,
          labels = c("A", "B"), ncol = 1, nrow = 2) |>
  annotate_figure(
    top = text_grob("Transformed Wealth Distribution of Billionaires in 2023",
                    face = "bold", size = 15))
```

The transformed distribution shows better normality compared with orignial data, yet more precise methods should be applied in further analysis, with the specific procedure depending on the analytic goal.

Divide the whole population into several wealth groups to see detailed distribution in different groups.

```{r wealth_groups}
# division
billionairs_wealth = 
  bil_2023 |>
  mutate(
    net_worth = 
      case_when(
        net_worth <= 5 ~ "<=5",
        net_worth > 5 & net_worth <= 10 ~ "5~10",
        net_worth > 10 & net_worth <= 100 ~ "10~100",
        net_worth > 100 ~ ">100"
      )) |>
  mutate(
    net_worth = 
      forcats::fct_relevel(
        net_worth, c("<=5", "5~10", "10~100", ">100")
      ))

# description
billionairs_wealth |>
  group_by(net_worth) |>
  summarize(N = n()) |>
  mutate(Proportion = N/sum(N)) |>
  knitr::kable() |>
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))

# visualization
## number of people
billionairs_wealth |>
  count(net_worth) |>
  plot_ly(x = ~net_worth, y = ~n, color = ~net_worth,
          type = "bar", colors = "viridis") |>
  layout(title = "Number of Billionaires in Different Wealth Groups",
         xaxis = list(title = "net wealth(billion dollars)"),
         yaxis = list(title = "number of billionaires"))

## age
billionairs_wealth |>
  plot_ly(y = ~age, color = ~net_worth, type = "box", colors = "viridis") |>
  layout(title = "Age Distribution of Different Wealth Groups",
         xaxis = list(title = "net wealth(billion dollars)"),
         yaxis = list(title = "age of billionaires"))

## gender
wealth_gender_distribution =
  billionairs_wealth |>
  ggplot(aes(x = net_worth, fill = gender)) + 
  geom_histogram(stat = "count", position = "dodge", binwidth = 15) +
  labs(title = "Gender Distribution of Different Wealth Groups",
       xaxis = list(title = "net wealth(billion dollars)"),
       yaxis = list(title = "number of billionaires"))

ggplotly(wealth_gender_distribution)
```

The table and plots show that the majority of billionaires possess a net wealth no more than 5 billion dollars. 

The number of people decreaeses while the average age increases in each group as the wealth goes up. There are more male billionaires than female in each group, and the group with largest net wealth consists of all males.

#### Distribution of Approach

Use the approach(self-made or not) as the factor to view the distribution.

```{r approach}
# description
bil_2023 |>
  group_by(self_made) |>
  summarize(mean_wealth = mean(net_worth),
            N = n()) |>
  mutate(Proportion = N/sum(N)) |>
  knitr::kable() |>
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))

# visualization
## number of people
bil_2023 |>
  count(self_made) |>
  plot_ly(x = ~self_made, y =~n, color = ~self_made,
          type = "bar", colors = "viridis") |>
  layout(title = "Number of Billionaires: Self-Made or Not",
         xaxis = list(title = "approach: self-made or not"),
         yaxis = list(title = "number of billionaires"))

## net worth
bil_2023 |>
  plot_ly(y = ~net_worth, color = ~self_made, 
          type = "box", colors = "viridis") |>
  layout(title = "Net Wealth of Self-Made or Not Billionaires",
         xaxis = list(title = "approach: self-made or not"),
         yaxis = list(title = "net wealth(billion dollars)"))
```

The proportion of self-made billionaires is way larger, yet there is no significant difference in the wealth distribution plot of the two groups.

#### Distribution of Status

Similarly, explore the underlying distribution of entrepreneur and inherited billionaires.

```{r status}
# description
bil_2023 |>
  group_by(wealth_status) |>
  summarize(mean_wealth = mean(net_worth),
            N = n()) |>
  mutate(Proportion = N/sum(N)) |>
  knitr::kable() |>
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))

# visualization
## number of people
bil_2023 |>
  count(wealth_status) |>
  plot_ly(x = ~wealth_status, y =~n, color = ~wealth_status,
          type = "bar", colors = "viridis") |>
  layout(title = "Number of Billionaires with Different Wealth Status",
         xaxis = list(title = "wealth status"),
         yaxis = list(title = "number of billionaires"))

## net worth
bil_2023 |>
  plot_ly(y = ~net_worth, color = ~wealth_status, 
          type = "box", colors = "viridis") |>
  layout(title = "Net Wealth of Billionaires with Different Wealth Status",
         xaxis = list(title = "wealth status"),
         yaxis = list(title = "net wealth(billion dollars)"))
```

The outliers in decreased and increased groups may indicate that billionaires with large amount of wealth tend to fluctuate in respect of net wealth.

### Demographic Distributions

#### Distribution of Age

Similar to the processing of wealth information, divide the population into four age groups to investigate the number and wealth distribution in details.

```{r age}
# overall distribution
age_distribution_1 =
  bil_2023 |>
  ggplot(aes(x = age)) + 
  geom_histogram()

age_distribution_2 =
  bil_2023 |>
  ggplot(aes(x = age)) + 
  geom_density()

ggarrange(age_distribution_1, age_distribution_2,
          labels = c("A", "B"), ncol = 1, nrow = 2) |>
  annotate_figure(
    top = text_grob("Overall Age Distribution of Billionaires in 2023",
                    face = "bold", size = 15))

# division
billionairs_age = 
  bil_2023 |>
  mutate(
    age = 
      case_when(
        age <= 55 ~ "<=55",
        age > 55 & age <= 65 ~ "55~65",
        age > 65 & age <= 75 ~ "65~75",
        age > 75 ~ ">75")) |>
  mutate(
    age = 
      forcats::fct_relevel(
        age, c("<=55", "55~65", "65~75", ">75")))

# description
billionairs_age |>
  group_by(age) |>
  summarize(mean_wealth = mean(net_worth),
            N = n()) |>
  mutate(Proportion = N/sum(N)) |>
  knitr::kable() |>
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))

# visualization
## number of people
billionairs_age |>
  count(age) |>
  plot_ly(x = ~age, y = ~n, color = ~age, 
          type = "bar", colors = "viridis") |>
  layout(title = "Number of Billionaires in Different Age Groups",
         xaxis = list(title = "age"),
         yaxis = list(title = "number of billionaires"))

## net worth
billionairs_age |>
  plot_ly(y = ~net_worth, color = ~age, type = "box", colors = "viridis") |>
  layout(title = "Net Wealth of Different Age Groups",
         xaxis = list(title = "age"),
         yaxis = list(title = "net wealth(billion dollars)"))

age_distribution_3 =  
  billionairs_age |>
  ggplot(aes(x = age, y = net_worth)) + 
  geom_violin(aes(fill = age), alpha = 0.5) +
  labs(title = "Net Wealth of Different Age Groups",
       x = "age of billionaires",
       y = "net wealth(billion dollars)")

ggplotly(age_distribution_3)
```

The overall age distribution is much more symmetric, resulting in a relatively evenly distributed number in the four groups. Though not very significant, the average net wealth tends to increase as the age of the group increases.

#### Distribution of Gender

Compare the proportion and average wealth possession of billionaires with different genders.

```{r gender}
# description
bil_2023 |>
  group_by(gender) |>
  summarize(mean_wealth = mean(net_worth),
            N = n()) |>
  mutate(Proportion = N/sum(N)) |>
  knitr::kable() |>
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))

# visualization
## number of people
bil_2023 |>
  count(gender) |>
  plot_ly(x = ~gender, y = ~n, color = ~gender,
          type = "bar", colors = "viridis") |>
  layout(title = "Number of Billionaires of Different Genders",
         xaxis = list(title = "gender"),
         yaxis = list(title = "number of billionaires"))

## net worth
bil_2023 |>
  plot_ly(y = ~net_worth, color = ~gender, type = "box", colors = "viridis") |>
  layout(title = "Net Wealth of Different Gender Groups",
         xaxis = list(title = "gender"),
         yaxis = list(title = "net wealth(billion dollars)"))

gender_distribution =   
  bil_2023 |>
  ggplot(aes(x = gender, y = net_worth)) +
  geom_violin(aes(fill = gender), alpha = 0.5) +
  labs(title = "Net Wealth of Different Gender Groups",
       x = "gender of billionaires",
       y = "net wealth(billion dollars)")

ggplotly(gender_distribution)
```

There is a way larger proportion of male billionaires compared with female. Despite the more extreme outliers in male group, the average net wealth of the two groups are similar to each other.

We can also plot using both age and gender as factors to see the distribution of net wealth in each subgroups.

```{r age_gender}
age_gender_distribution = 
  billionairs_age |>
  ggplot(aes(x = age, y = net_worth)) +
  geom_violin(aes(fill = age)) +
  facet_grid(gender~.) +
  labs(title = "Net Wealth of Different Aenders and Age Groups",
       x = "age of billionaires",
       y = "net wealth(billion dollars)")

ggplotly(age_gender_distribution)
```

The panels separated by gender exhibit similar distribution patterns to the combined ones above, with more data points as well as outliers in the group of male, and no siginificant difference in different age groups.

#### Distribution of Country

The countries of citizenship and residence are quite scattered in distribution. Filter the top 10 countries with most billionaires to see the net wealth distribution in each country.

```{r citizenship}
# description
bil_2023 |>
  group_by(country_of_citizenship) |>
  summarize(mean_wealth = mean(net_worth),
            N = n()) |>
  knitr::kable() |>
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))

# visualization
## number of people
bil_2023 |>
  count(country_of_citizenship) |>
  mutate(country_of_citizenship = fct_reorder(country_of_citizenship, n)) |>
  plot_ly(x = ~country_of_citizenship, y = ~n, color = ~country_of_citizenship,
          type = "bar", colors = "viridis") |>
  layout(title = "Number of Billionaires with Different Citizenship",
         xaxis = list(title = "country of citizenship"),
         yaxis = list(title = "number of billionaires"))

## net worth of top 10
citizenship = 
  bil_2023 |>
  group_by(country_of_citizenship) |>
  summarize(n_obs = n()) |>
  arrange(desc(n_obs)) |>
  slice(1:10) |>
  pull(country_of_citizenship)

bil_2023 |>
  filter(country_of_citizenship %in% citizenship) |>
  plot_ly(x = ~country_of_citizenship, y = ~net_worth, 
          color = ~country_of_citizenship, type = "box", colors = "viridis") |>
  layout(title = "Net Wealth of Billionaires with Different Citizenship",
         xaxis = list(title = "country of citizenship(top 10)"),
         yaxis = list(title = "net wealth(billion dollars)"))
```

```{r residence}
# description
bil_2023 |>
  group_by(country_of_residence) |>
  summarize(mean_wealth = mean(net_worth),
            N = n()) |>
  knitr::kable() |>
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))

# visualization
## number of people
bil_2023 |>
  count(country_of_residence) |>
  mutate(country_of_residence = fct_reorder(country_of_residence, n)) |>
  plot_ly(x = ~country_of_residence, y = ~n, color = ~country_of_residence,
          type = "bar", colors = "viridis") |>
  layout(title = "Number of Billionaires with Different Residence",
         xaxis = list(title = "country of residence"),
         yaxis = list(title = "number of billionaires"))

## net worth in top 10
residence = 
  bil_2023 |>
  group_by(country_of_residence) |>
  summarize(n_obs = n()) |>
  arrange(desc(n_obs)) |>
  slice(1:10) |>
  pull(country_of_residence)

bil_2023 |>
  filter(country_of_residence %in% residence) |>
  plot_ly(x = ~country_of_residence, y = ~net_worth, 
          color = ~country_of_residence, type = "box", colors = "viridis") |>
  layout(title = "Net Wealth of Billionaires with Different Residence",
         xaxis = list(title = "country of residence(top 10)"),
         yaxis = list(title = "net wealth(billion dollars)"))
```

There are actually many overlaps in the country with most cizitenship and residence, which leads to the similarity in the two box plots.

### Industry Distribution

To better understand the relationship between the development of industries and the arise of billionaires, describe and visualize the distribution of billionaires in different industry fields.

```{r industry}
# description
bil_2023 |>
  group_by(industries) |>
  summarize(mean_wealth = mean(net_worth),
            N = n()) |>
  knitr::kable() |>
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))

# visualization
## number of people
bil_2023 |>
  count(industries) |>
  mutate(industries = fct_reorder(industries, n)) |>
  plot_ly(x = ~industries, y = ~n, color = ~industries,
          type = "bar", colors = "viridis") |>
  layout(title = "Number of Billionaires in Different Industries",
         xaxis = list(title = "industry field"),
         yaxis = list(title = "number of billionaires"))

## net worth
bil_2023 |>
  plot_ly(x = ~industries, y = ~net_worth, color = ~industries,
          type = "box", colors = "viridis") |>
  layout(title = "Net Wealth of Billionaires in Different Industries",
         xaxis = list(title = "industry field"),
         yaxis = list(title = "net wealth(billion dollars)"))

bil_2023 |>
  mutate(industries = fct_reorder(industries, net_worth)) |>
  ggplot(aes(y = industries, x = net_worth)) +
  geom_violin(aes(fill = industries), alpha = 0.5) +
  theme(legend.position = "bottom") +
  labs(title = "Net Wealth of Billionaires in Different Industries",
       x = "industry field",
       y = "net wealth(billion dollars)")
```

The wealth distributions in different industries look close to each other due to the extreme outliers, which requires further test to verify the potential trends.

## Compare data collected in 2013 and 2023

We can compare some basic distribution between different years as well. Filter the data collected in year 2013 and 2023 to show the change over a decade.

```{r compare}
# filter data
bil_2013_2023 =
  bil_2010_2023 |>
  filter(year == 2013 | year == 2023) |>
  mutate(year = as.factor(year))

# description
## overall number and wealth
bil_2013_2023 |>
  group_by(year) |>
  summarize(N = n(),
            mean_wealth = mean(net_worth)) |>
  knitr::kable() |>
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))

## number and wealth grouped by gender
bil_2013_2023 |>
  group_by(year, gender) |>
  summarize(N = n(),
            mean_wealth = mean(net_worth)) |>
  knitr::kable() |>
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))

# visualization
## number of people
year_gender_distribution_1 =
  bil_2013_2023 |>
  ggplot(aes(x = gender, group = year, fill = year)) +
  geom_histogram(stat = "count", position = "dodge") +
  labs(title = "Gender Distribution: 2013 versus 2023",
       x = "gender of billionaires",
       y = "number of billionaires")

ggplotly(year_gender_distribution_1)

## net worth
bil_2013_2023 |>
  plot_ly(x = ~year, y = ~net_worth, color = ~year,
          type = "box", colors = "viridis") |>
  layout(title = "Overall Wealth Distribution: 2013 versus 2023",
         xaxis = list(title = "year of data collection"),
         yaxis = list(title = "net wealth(billion dollars)"))

year_gender_distribution_2 =
  bil_2013_2023 |>
  ggplot(aes(y = net_worth, x = gender, fill = gender)) +
  geom_violin() +
  facet_grid(.~year) +
  labs(title = "Wealth Distribution over Gender and Year",
       x = "gender of billionaires",
       y = "net wealth(billion dollars)")

ggplotly(year_gender_distribution_2)
```

The total number of billionaires have increased over time, with a larger amount of average net wealth in each group as well. The proportion of male remains dominated, yet further tests are needed before reaching a conclusion.

## Switch to GDP data

The GDP of different industries may be more relevant to the arise and distribution of billionaires rather than the field type itself. The combination of these data is depicted as below.

```{r gdp}
# visualization
## number of people
bil_gdp |>
  group_by(industries, industry_gdp) |>
  summarize(n_obs = n()) |>
  mutate(industries = fct_reorder(industries, n_obs),
         text_label = 
           str_c("Industry: ", industries, 
            "\nIndustry GDP: ", industry_gdp,
            "\nNumber of Billionaires: ", n_obs)) |>
  plot_ly(x = ~industries, y = ~n_obs, color = ~industries,
          mode = "markers", text = ~text_label, 
          type = "bar", colors = "viridis") |>
  layout(title = "Number of Billionaires in Different Industries",
         xaxis = list(title = "industry field"),
         yaxis = list(title = "number of billionaires"))

## net worth
bil_gdp |>
  mutate(
    text_label = 
      str_c("Industry: ", industries, 
            "\nIndustry GDP: ", industry_gdp,
            "\nNet Wealth of Billionaire: ", net_worth)) |>
  plot_ly(x = ~industries, y = ~net_worth, color = ~industries, 
          mode = "markers", text = ~text_label, 
          type = "scatter", colors = "viridis") |>
  layout(title = "Net Wealth versus Industry GDP",
         xaxis = list(title = "industry GDP(trillion dollars)"),
         yaxis = list(title = "net wealth of billionaires(billion dollars)"))
```

It can be seen from the plot that the number and net wealth of billionaires are quite different in different industries, with largest number and wealth falling in Finance & Investments and Technology, respectively.